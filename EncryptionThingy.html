<!DOCTYPE html>

<!--
Name: EncryptionThingy
Author: Chris DiMaio
Description: A Javascript driven tool for encrypting and attaching documents. 
-->

<html>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/pbkdf2.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>

<script type="application/json" id="data">
{"keyalgorithm":"PBKDF2WithHmacSHA1","encryptionmethod":"AES/CBC/PKCS5Padding","ciphertext":"d82Doc3eAX3RJ519bAxJB5LYJSAwgBZ+ITQBkRZ8E2QdJbdNRj2PFZ0wnwHMro4y","salt":"pwbbDpDyrQUnanYqHoinIA==","keylength":128,"iv":"2KSSDSHxUHnnMrBZ42YmhQ==","iterations":65536}
</script>

<script type="text/javascript">
// var data = JSON.parse(document.getElementById('data').innerHTML);

// var keyLength 	= data.encryptionmethod
// var ciphertext 	= data.ciphertext
// var iterations	= data.iterations

// Larger iterations are crashing script...
var iterations = 10;
var salt = CryptoJS.lib.WordArray.random(128/8);
var key  = CryptoJS.PBKDF2("password", salt, { keySize: 256/32, iterations: this.iterations });

// Encrypt
var iv          = CryptoJS.enc.Hex.parse("101112131415161718191a1b1c1d1e1f");
var encrypted   = CryptoJS.AES.encrypt("You are reading a super secret message.", key, { iv: this.iv });
var ciphertext  = encrypted.ciphertext.toString(CryptoJS.enc.Base64);

// window.alert(ciphertext);

var jsonObj        = {};
jsonObj.iv         = iv;
jsonObj.salt       = salt;
jsonObj.ciphertext = ciphertext;
jsonObj.iterations = iterations;

window.alert(JSON.stringify(jsonObj));

// Decrypt
var cipherParams = CryptoJS.lib.CipherParams.create({ ciphertext: CryptoJS.enc.Base64.parse(ciphertext) });
var decrypted    = CryptoJS.AES.decrypt( cipherParams, key, { iv: this.iv });
var plaintext    = decrypted.toString(CryptoJS.enc.Utf8);

window.alert(plaintext);
</script>
</html>
